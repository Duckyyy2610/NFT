{% extends 'main.html' %}
{% load my_custom_tags %}
<!-- {% load static %} -->
{% block content %}
<div class="container">
    <div class="product-detail-web">
        <div class="product-detail__img--wrap">
            <div class="img__info">
                <div class="view-original-media">
                </div>
                <form method="POST" class="like-button-form">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="like">
                    <button class="like-button">
                        {{product.like.all.count}}
                        <svg class="product-detail__svg" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512" fill="#fff"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M47.6 300.4L228.3 469.1c7.5 7 17.4 10.9 27.7 10.9s20.2-3.9 27.7-10.9L464.4 300.4c30.4-28.3 47.6-68 47.6-109.5v-5.8c0-69.9-50.5-129.5-119.4-141C347 36.5 300.6 51.4 268 84L256 96 244 84c-32.6-32.6-79-47.5-124.6-39.9C50.5 55.6 0 115.2 0 185.1v5.8c0 41.5 17.2 81.2 47.6 109.5z"/></svg>
                    </button>
                </form>
            </div>
            <div class="product-detail__img--wrap-2">
                <img src="{{product.image}}" alt="" class="product-detail__img">
            </div>
        </div>
        <div class="product-detail__info">
            <p class="product-detail__topic">{{product.topic}}</p>
            <h1 class="product-detail__name">{{product.name}}</h1>
            <p class="product-detail__author">
                Owned by
                <a href="{% url 'profile' product.author.id %}">{{product.author.name}}</a>
            </p>
            <div class="product-statistic">
                <div class="product-statistic__list flex_aic_jcc">
                    <!-- <li class="product-statistic__item flex_fdc_aif">
                        <p class="product-statistic__value">{{product.rarity}}</p>
                        <p class="product-statistic__key">Rarity</p>
                    </li> -->
                    <li class="product-statistic__item flex_fdc_aif">
                        <p class="product-statistic__value">#{{rarity_rank}} / #{{product_quantity}}</p>
                        <p class="product-statistic__key">Rarity Rank</p>
                    </li>
                    <li class="product-statistic__item flex_fdc_aif">
                        <button class="product-statistic__value product-owner-number">{{product.owners.all|length}}</button>
                        <button class="product-statistic__key product-owner-button">Owners</button>
                    </li>
                    <li class="product-statistic__item flex_fdc_aif">
                        <button class="product-statistic__value product-favorite-number">{{product_favorite_list|length}}</button>
                        <button class="product-statistic__key product-favorite-button">Favorites</button>
                    </li>
                </div>
            </div>
            <div class="product-detail__offer">
                <p class="product-detail__current-price">
                    Current price
                </p>
                <p class="product-detail__price">
                    {{product.price}} ETH <span class="product-detail__price-dollars">${% multiply product.price 1547.74 %}</span class="product-detail__price-dollars">
                </p>
                <form action="{% url 'collection1' product.id %}" class="product-detail__buy-form">
                    <button class="buy-button">Buy now</button>
                    <a href="?filter=add-to-cart" class="add-to-cart flex_aic_jcc">
                        <svg class="product-detail__svg" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 576 512" style="fill:#ffffff"><path d="M0 24C0 10.7 10.7 0 24 0H69.5c22 0 41.5 12.8 50.6 32h411c26.3 0 45.5 25 38.6 50.4l-41 152.3c-8.5 31.4-37 53.3-69.5 53.3H170.7l5.4 28.5c2.2 11.3 12.1 19.5 23.6 19.5H488c13.3 0 24 10.7 24 24s-10.7 24-24 24H199.7c-34.6 0-64.3-24.6-70.7-58.5L77.4 54.5c-.7-3.8-4-6.5-7.9-6.5H24C10.7 48 0 37.3 0 24zM128 464a48 48 0 1 1 96 0 48 48 0 1 1 -96 0zm336-48a48 48 0 1 1 0 96 48 48 0 1 1 0-96z"/>
                        </svg>
                    </a>    
                </form>
            </div>
        </div>
        
    </div>

    <div class="product-detail-mobile">
        <div class="product-detail__info-1">
            <p class="product-detail__topic">{{product.topic}}</p>
            <h1 class="product-detail__name">{{product.name}}</h1>
            <p class="product-detail__author">
                Owned by
                <a href="{% url 'profile' product.author.id %}">{{product.author.name}}</a>
            </p>
        </div>
        <div class="product-detail__img--wrap">
            <div class="img__info">
                <div class="view-original-media">
                </div>
                <form method="POST" class="like-button-form">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="like">
                    <button class="like-button">
                        {{product.like.all.count}}
                        <svg class="product-detail__svg" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512" fill="#fff"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M47.6 300.4L228.3 469.1c7.5 7 17.4 10.9 27.7 10.9s20.2-3.9 27.7-10.9L464.4 300.4c30.4-28.3 47.6-68 47.6-109.5v-5.8c0-69.9-50.5-129.5-119.4-141C347 36.5 300.6 51.4 268 84L256 96 244 84c-32.6-32.6-79-47.5-124.6-39.9C50.5 55.6 0 115.2 0 185.1v5.8c0 41.5 17.2 81.2 47.6 109.5z"/></svg>
                    </button>
                </form>
            </div>
            <div class="product-detail__img--wrap-2">
                <img src="{{product.image}}" alt="" class="product-detail__img">
            </div>
        </div>
        <div class="product-detail__info">
            <div class="product-statistic">
                <div class="product-statistic__list flex_aic_jcc">
                    <!-- <li class="product-statistic__item flex_fdc_aif">
                        <p class="product-statistic__value">{{product.rarity}}</p>
                        <p class="product-statistic__key">Rarity</p>
                    </li> -->
                    <li class="product-statistic__item flex_fdc_aif">
                        <p class="product-statistic__value">#{{rarity_rank}} / #{{product_quantity}}</p>
                        <p class="product-statistic__key">Rarity Rank</p>
                    </li>
                    <li class="product-statistic__item flex_fdc_aif">
                        <button class="product-statistic__value product-owner-number">{{product.owners.all|length}}</button>
                        <button class="product-statistic__key product-owner-button">Owners</button>
                    </li>
                    <li class="product-statistic__item flex_fdc_aif">
                        <button class="product-statistic__value product-favorite-number">{{product_favorite_list|length}}</button>
                        <button class="product-statistic__key product-favorite-button">Favorites</button>
                    </li>
                </div>
            </div>
            <div class="product-detail__offer">
                <p class="product-detail__current-price">
                    Current price
                </p>
                <p class="product-detail__price">
                    {{product.price}} ETH <span class="product-detail__price-dollars">${% multiply product.price 1547.74 %}</span class="product-detail__price-dollars">
                </p>
                <form action="{% url 'collection1' product.id %}" class="product-detail__buy-form">
                    <button class="buy-button">Buy now</button>
                    <a href="?filter=add-to-cart" class="add-to-cart flex_aic_jcc">
                        <svg class="product-detail__svg" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 576 512" style="fill:#ffffff"><path d="M0 24C0 10.7 10.7 0 24 0H69.5c22 0 41.5 12.8 50.6 32h411c26.3 0 45.5 25 38.6 50.4l-41 152.3c-8.5 31.4-37 53.3-69.5 53.3H170.7l5.4 28.5c2.2 11.3 12.1 19.5 23.6 19.5H488c13.3 0 24 10.7 24 24s-10.7 24-24 24H199.7c-34.6 0-64.3-24.6-70.7-58.5L77.4 54.5c-.7-3.8-4-6.5-7.9-6.5H24C10.7 48 0 37.3 0 24zM128 464a48 48 0 1 1 96 0 48 48 0 1 1 -96 0zm336-48a48 48 0 1 1 0 96 48 48 0 1 1 0-96z"/>
                        </svg>
                    </a>
                </form>
            </div>
        </div>
        
    </div>
</div>

{% include 'NFTapp/favorite.html' %}
{% include 'NFTapp/owner.html' %}

<div class="gap-between-section"></div>

{% include 'NFTapp/comment.html' %}
{% endblock content %}

{% block scripts %}
<script>
    console.log("------------------------------------------");
    const productOwnerNumber = document.querySelectorAll(".product-owner-number");
    const productFavoriteNumber = document.querySelectorAll(".product-favorite-number");

    const productOwnerButton = document.querySelectorAll('.product-owner-button');
    const productFavoriteButton = document.querySelectorAll('.product-favorite-button');
    console.log(productFavoriteButton);

    productOwnerNumber.forEach(element => {
    element.onclick = (e) => {
        document.querySelector(".container-owner").style.display = 'flex';
    }
    });

    productOwnerButton.forEach(button => {
        button.onclick = (e) => {
            document.querySelector(".container-owner").style.display = 'flex';
        }
    });

    productFavoriteNumber.forEach(element => {
        element.onclick = (e) => {
            document.querySelector(".container-favorite").style.display = 'flex';
        }
    });

    productFavoriteButton.forEach(button => {
        button.onclick = (e) => {
            document.querySelector(".container-favorite").style.display = 'flex';
        }
    });

    const likeButton = document.querySelectorAll('.like-button');
    // likeButton.forEach(button => {
    //     button.onclick = (e) => {
    //         button.querySelector('.product-detail__svg').style.fill = '{{clicked|escapejs}}';
    //     }
    //          $.ajax({
    //             type: 'POST',
    //             url: '/collection1/{{product.id|escapejs}}',
    //             data: {
    //                 clicked: clicked,
    //                 csrfmiddlewaretoken: button.parentElement.querySelector('input[name="csrfmiddlewaretoken"]').value,
    //             },
    //             success: function(data) {
                
    //             }
    //         });
    // });
    likeButton.forEach(button => {
        if('{{like|escapejs}}' === 'True') {
            button.querySelector('.product-detail__svg').style.fill = '#ff3040';
        } else {
            button.querySelector('.product-detail__svg').style.fill = '#fff';
        }
    });
</script>
{% endblock scripts %}
